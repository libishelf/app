<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LibiShelf - Library Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden fade-in">
        <div class="pt-8 pb-6 flex flex-col items-center border-b border-slate-50">
            <!-- Using your logo from GitHub repo -->
            <img src="logo.svg" alt="LibiShelf Logo" class="h-10 w-auto mb-2" onerror="this.src='https://via.placeholder.com/150?text=LibiShelf'">
            <h1 class="text-lg font-bold tracking-tight text-slate-800">LibiShelf</h1>
        </div>

        <div class="p-8">
            <div id="auth-container"></div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const API_URL = 'YOUR_API_GATEWAY_URL'; // <--- PASTE YOUR API GATEWAY INVOKE URL HERE

        let currentState = 'signup-email';
        let userData = { email: '', schoolName: '', schoolAddress: '', password: '', bookCount: 0, selectedPlan: '' };

        const container = document.getElementById('auth-container');

        async function apiRequest(data) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (err) {
                showMessage("Connection Error: " + err.message);
            }
        }

        function render() {
            container.innerHTML = '';
            switch(currentState) {
                case 'signup-email':
                    container.innerHTML = `
                        <h2 class="text-sm font-semibold mb-4 text-center text-slate-500 uppercase tracking-wider">Create Account</h2>
                        <input type="email" id="email" value="${userData.email}" class="w-full px-3 py-2 border rounded-lg mb-3 text-sm" placeholder="Email Address">
                        <button onclick="handleEmailContinue()" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-blue-700">Continue</button>
                        <p class="text-center text-xs text-slate-400 mt-4">Already have an account? <a href="#" onclick="setState('login')" class="text-blue-600 font-bold">Sign In</a></p>
                    `;
                    break;
                case 'signup-details':
                    container.innerHTML = `
                        <h2 class="text-sm font-semibold mb-4 text-center text-slate-500 uppercase">School Info</h2>
                        <input type="text" id="sn" class="w-full px-3 py-2 border rounded-lg mb-2 text-sm" placeholder="School Name">
                        <input type="text" id="sa" class="w-full px-3 py-2 border rounded-lg mb-2 text-sm" placeholder="School Address">
                        <input type="password" id="pw" class="w-full px-3 py-2 border rounded-lg mb-2 text-sm" placeholder="Password">
                        <input type="password" id="cp" class="w-full px-3 py-2 border rounded-lg mb-3 text-sm" placeholder="Confirm Password">
                        <button onclick="handleDetailsContinue()" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-medium">Continue</button>
                    `;
                    break;
                case 'signup-books':
                    container.innerHTML = `
                        <h2 class="text-sm font-semibold mb-2 text-center text-slate-500 uppercase">Collection Size</h2>
                        <p class="text-xs text-center text-slate-400 mb-4">How many books are in your library?</p>
                        <input type="number" id="bc" class="w-full px-3 py-2 border rounded-lg mb-4 text-center text-xl font-bold" placeholder="500">
                        <button onclick="handleBooksContinue()" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-medium">View Plans</button>
                    `;
                    break;
                case 'signup-plans':
                    const over5k = userData.bookCount > 5000;
                    container.innerHTML = `
                        <h2 class="text-sm font-semibold mb-4 text-center text-slate-500 uppercase">Select Plan</h2>
                        <div class="space-y-3">
                            <div onclick="userData.selectedPlan='pro';render()" class="p-3 border rounded-xl cursor-pointer ${userData.selectedPlan==='pro'?'border-blue-500 bg-blue-50':'border-slate-100'} ${!over5k?'ring-2 ring-blue-100':''}">
                                <div class="flex justify-between font-bold text-sm"><span>Pro</span> <span>$5.00</span></div>
                                <p class="text-[10px] text-slate-500">Up to 5,000 items, Offline mode, Challenges</p>
                            </div>
                            <div onclick="userData.selectedPlan='ultimate';render()" class="p-3 border rounded-xl cursor-pointer ${userData.selectedPlan==='ultimate'?'border-blue-500 bg-blue-50':'border-slate-100'} ${over5k?'ring-2 ring-blue-100':''}">
                                <div class="flex justify-between font-bold text-sm"><span>Ultimate</span> <span>$10.00</span></div>
                                <p class="text-[10px] text-slate-500">Up to 100,000 items, All Pro features</p>
                            </div>
                        </div>
                        <button onclick="handleSignupFinal()" class="w-full bg-slate-900 text-white py-2 rounded-lg text-sm font-medium mt-4">Create Account</button>
                    `;
                    break;
                case 'success':
                    container.innerHTML = `<div class="text-center"><h2 class="text-lg font-bold text-green-600 mb-2">Success!</h2><p class="text-xs text-slate-500 mb-4">Account created.</p><button onclick="setState('login')" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm">Sign In</button></div>`;
                    break;
                case 'login':
                    container.innerHTML = `
                        <h2 class="text-sm font-semibold mb-4 text-center text-slate-500 uppercase">Sign In</h2>
                        <input type="email" id="le" class="w-full px-3 py-2 border rounded-lg mb-2 text-sm" placeholder="Email">
                        <input type="password" id="lp" class="w-full px-3 py-2 border rounded-lg mb-3 text-sm" placeholder="Password">
                        <button onclick="handleLogin()" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-medium">Sign In</button>
                        <p class="text-center text-xs text-slate-400 mt-4">New here? <a href="#" onclick="setState('signup-email')" class="text-blue-600 font-bold">Sign Up</a></p>
                    `;
                    break;
            }
        }

        function setState(s) { currentState = s; render(); }

        function handleEmailContinue() {
            userData.email = document.getElementById('email').value;
            if(!userData.email) return;
            setState('signup-details');
        }

        function handleDetailsContinue() {
            userData.schoolName = document.getElementById('sn').value;
            userData.schoolAddress = document.getElementById('sa').value;
            userData.password = document.getElementById('pw').value;
            if(userData.password !== document.getElementById('cp').value) return showMessage("Passwords mismatch");
            setState('signup-books');
        }

        function handleBooksContinue() {
            userData.bookCount = parseInt(document.getElementById('bc').value) || 0;
            userData.selectedPlan = userData.bookCount > 5000 ? 'ultimate' : 'pro';
            setState('signup-plans');
        }

        async function handleSignupFinal() {
            const res = await apiRequest({ action: 'signup', ...userData });
            if(res.message) setState('success');
            else showMessage(res.error || "Signup failed");
        }

        async function handleLogin() {
            const email = document.getElementById('le').value;
            const password = document.getElementById('lp').value;
            const res = await apiRequest({ action: 'login', email, password });
            if(res.user) showMessage("Welcome back, " + res.user.SchoolName);
            else showMessage(res.error || "Login failed");
        }

        function showMessage(txt) {
            const t = document.createElement('div');
            t.className = 'fixed bottom-4 bg-black text-white px-4 py-2 rounded-full text-[10px] left-1/2 -translate-x-1/2 shadow-lg';
            t.innerText = txt;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        render();
    </script>
</body>
</html>
